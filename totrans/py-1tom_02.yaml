- en: REPL 环境
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Python 的 REPL 环境
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 安装完 Python 之后都会提供一个 REPL－Read-Eval-Print Loop，不过 Python 默认的 REPL 环境实在是简陋， 很多开发者就开发了更加强大的
    REPL 工具，包括控制台和基于 web 的，其中比较有名的有：
  prefs: []
  type: TYPE_NORMAL
- en: IPython（IPython Notebook）
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: BPython
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ptPython
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: BPython
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: BPython
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 相比 IPython，BPython 并不算得上功能强大，它的开发初衷仅在于部分增强原始 REPL 的交互性， 并没有向 IDE 发展的意思，以保持轻量、简单为目的。
    根据[官网](http://www.bpython-interpreter.org/about.html)介绍，它有这些特性：
  prefs: []
  type: TYPE_NORMAL
- en: 行内的语法高亮
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 自动提示
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 函数参数提示
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 时光倒流（Rewind）
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 这里需要注意一下，BPython 的 rewind 并不是撤销，而是将之前执行过的命令在全新的环境中重新执行到上一步。
  prefs: []
  type: TYPE_NORMAL
- en: 历史输出
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 退出 BPython 时会将屏幕中所有的信息输出到 stdout，也就是说你可以在 shell 中看到之前看过的一切。
  prefs: []
  type: TYPE_NORMAL
- en: 支持 Python 3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 自定义配置
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: IPython
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: IPython
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: IPython 是一个增强了交互能力的 Python REPL 环境，IPython v1-3 版本安装同时会安装 IPython notebook，相当于一个网页版的
    REPL 环境。 相对于原生的 Python REPL，IPython 主要提供了 Tab 自动补全、shell 命令交互、 快速文档查询等功能。 除了在
    shell 中使用外，Django shell 以及 PyCharm IDE 都提供了 IPython 的支持—— 安装了 IPython 后会选择其作为默认
    python shell。
  prefs: []
  type: TYPE_NORMAL
- en: 启动 & 退出
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 启动 IPython：`ipython`
  prefs: []
  type: TYPE_NORMAL
- en: 启动 IPython notebook：`ipython notebook`
  prefs: []
  type: TYPE_NORMAL
- en: 启动 IPython Qt shell：`ipython qtshell`
  prefs: []
  type: TYPE_NORMAL
- en: 退出：双击 Ctrl-D 或者 `exit` 或者 `quit` 或者 `exit()`。
  prefs: []
  type: TYPE_NORMAL
- en: 特性
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Tab 补全
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 原生的 Python shell 可以通过 `rlcompleter` 和 `readline` 库获得 Tab 补全能力：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: IPython 的支持更强大一些。不过 IPython 的自动补全依旧是循环式的，需要菜单式的可以试试 ptpython。
  prefs: []
  type: TYPE_NORMAL
- en: 魔法指令（Magic Command）
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 魔法指令是 IPython 定义的命令，以提供 IPython 环境下与环境交互的能力，通常对应于 shell 命令。 你可以在 IPython 控制台中输入
    `ls` 或者 `%ls` 来查看当前目录文件。
  prefs: []
  type: TYPE_NORMAL
- en: 魔法指令通常以 `%` 开始，对于非 `%` 开始的魔法指令，IPython 会首先判断它是不是 Python 对象，如是对象则优先作为 Python
    对象处理。
  prefs: []
  type: TYPE_NORMAL
- en: 更全面的 magic 命令列表和功能介绍见[这里](https://damontallen.github.io/IPython-quick-ref-sheets/)。
  prefs: []
  type: TYPE_NORMAL
- en: 魔法指令中还包括了很多 Shell 命令，但并不是全部，IPython 也支持直接执行 Shell 命令，只需要以感叹号 `!` 起始，例如：`!ls`。
  prefs: []
  type: TYPE_NORMAL
- en: Plot
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 常见用法是配合 mathplotlib 等 plot 库和 IPython 插件，在终端、Qt console 或者 Notebook 中展示图表。
  prefs: []
  type: TYPE_NORMAL
- en: 内省
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 函数内省
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: IPython 提供了 `?` 和 `??` 命令用于内省，`?` 会显示函数简介，`??` 会连源代码一起显示 （如果可用的话）。
  prefs: []
  type: TYPE_NORMAL
- en: 输入历史
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '`hist` 魔法指令可以用来输出输入历史：'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 要去掉历史记录中的序号，使用命令 `hist -n`：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 这样你就可以方便的将代码复制到一个文本编辑器中。
  prefs: []
  type: TYPE_NORMAL
- en: 要在历史记录中搜索可以先输入一个匹配模型，然后按 `Ctrl-p` ，找到一个匹配后，继续按 `Ctrl-p` 会向后搜索再上一个匹配，`Ctrl-n`
    则是向前搜索最近的匹配。
  prefs: []
  type: TYPE_NORMAL
- en: 编辑
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 当在 Python 提示符下试验一个想法时，经常需要通过编辑器修改源代码（甚至是反复修改）。 在 IPython 下输入魔法指令 `edit` 就会根据环境变量
    `$EDITOR` 调用相应的编辑器。 如果 `$EDITOR` 为空，则会调用 vi（Unix）或记事本（Windows）。 要回到 IPython 提示符，直接退出编辑器即可。
  prefs: []
  type: TYPE_NORMAL
- en: '如果是保存并退出编辑器，输入编辑器的代码会在当前名字空间下被自动执行。 如果你不想这样，使用 `edit -x`。如果要再次编辑上次最后编辑的代码，使用
    `edit -p`。 在上一个特性里，我提到使用 `hist -n` 可以很容易的将代码拷贝到编辑器。 一个更简单的方法是 `edit` 加 Python
    列表的切片（slice）语法。假定 `hist` 输出如下:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 现在要将第 4、5、6 句代码导出到编辑器，只要输入：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 交互调试
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 调试方面常用的魔术命令有 `ru`、`prun`、`time`、`timeit` 等等。更直接的方式是借助系统调试工具 pdb。
  prefs: []
  type: TYPE_NORMAL
- en: 快捷键及配置
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 作为库使用
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NotFinished，虽然ipython -p pysh提供了一个强大的shell替代品，但它缺少正确的job控制。在运行某个很耗时的任务时按下Ctrl-z将会停止IPython
    session而不是那个子进程。
  prefs: []
  type: TYPE_NORMAL
- en: 问题和方法
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 虽然作为标准 Python Shell 的替代，IPython 总的来说很完美，但仍然存在一些问题。
  prefs: []
  type: TYPE_NORMAL
- en: 粘贴代码缩进问题
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '默认情况下，IPython 会对粘贴的已排好缩进的代码重新缩进。例如下面的代码:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '会变成:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 这是因为 `autoindent` 默认是启用状态，可以用 magic 命令 `autoindent` 来开关自动缩进， 就像在 Vim 中设置 `set
    paste` 一样。
  prefs: []
  type: TYPE_NORMAL
- en: 或者，你也可以使用魔法指令 `%paste` 粘贴并执行剪贴板中的代码。
  prefs: []
  type: TYPE_NORMAL
- en: Vim 模式
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Mac 下的快捷启动
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: IPython wiki 提供了一段 [AppleScript launcher](https://github.com/ipython/ipython/wiki/Cookbook:-Launching-IPython-on-OSX#using-iterm2-and-an-applescript-launcher)
    脚本，把它写入 `~/bin/ipy` 在 Mac Spotlight 中输入 `ipy` 并回车就可以在新 iTerm 窗口中打开 IPython Shell。
    下面是我稍微修改后的版本：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: IPython notebook
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 启动
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 在终端输入： `ipython notebook`
  prefs: []
  type: TYPE_NORMAL
- en: IPython notebook 的使用和 Vim 有些类似，分“命令模式”和“编辑模式”，切换方法同样为 `ESC` 键。 在命令模式下按 `h` 可以呼出帮助菜单，貌似不区分大小写。
  prefs: []
  type: TYPE_NORMAL
- en: 设置 Django Shell
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Django Shell 增强
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 由于 Django 系统的特殊性，很难在 Shell 中直接导入 Django 应用，而只能使用它自己提供的 shell 命令。不过，并不是说就没有办法使用增强的第三方
    Shell 了，[Django-Extensions](http://django-extensions.readthedocs.org/) 插件提供了切换默认
    Shell 的能力。
  prefs: []
  type: TYPE_NORMAL
- en: Django Extensions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Django-Extensions](http://django-extensions.readthedocs.org/) 是一个 Django 第三方插件集，其中囊括了很多实用的
    Django 插件， 当然也包括本文的主角 `shell_plus`。'
  prefs: []
  type: TYPE_NORMAL
- en: shell_plus
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 装上插件后只需要将 `django_extensions` 加入 `INSTALLED_APPS` 列表中即可使用 IPython 作为默认 Shell（如果已安装的话）。
    需要注意的是，如果在 virtualenv 环境中使用 Django 的话，同样需要在 virtualenv 中安装 IPython。
  prefs: []
  type: TYPE_NORMAL
- en: 如果你偏好的是 BPython 的话，[shell_plus](http://django-extensions.readthedocs.org/en/latest/shell_plus.html#interactive-python-shells)
    同样提供了相关命令：`shell_plus`。使用方法：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 该命令对 IPython 同样适用：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 或者，有需要的话，也可以切换回原生 Python：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 默认 Shell 的选择顺序是 BPython、IPython、Python。
  prefs: []
  type: TYPE_NORMAL
- en: 你同样可以在文件中配置默认 Shell：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 设置
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 默认情况下 shell_plus 会自动加载你的全部 Model，其中可能会出现重名或者其它问题， 你可以通过配置文件来修改它的加载机制。
  prefs: []
  type: TYPE_NORMAL
- en: 注意：这里的设置只会作用于 shell_pull 而不会影响你的整改系统。
  prefs: []
  type: TYPE_NORMAL
- en: 将名为 blog 的 app 中 的 Messages 模块以 blog_messages 名加载
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 不加载 app 'sites' 中的全部 model，以及 app 'blog' 中的 'pictures' Model。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: '`SHELL_PLUS_MODEL_ALIASES` 和 `SHELL_PLUS_DONT_LOAD` 可以同时使用。'
  prefs: []
  type: TYPE_NORMAL
- en: 也可以像这样在运行 manage.py 时再设定不自动加载的模块：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 命令行和配置文件中的设置会合并后再生效。
  prefs: []
  type: TYPE_NORMAL
- en: IPython Notebook
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: shell_plus 同时还支持 [IPython Notebook]：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: Notebook 相关的设置参数有两个：`NOTEBOOK_ARGUMENTS` 和 `IPYTHON_ARGUMENTS`：
  prefs: []
  type: TYPE_NORMAL
- en: '`NOTEBOOK_ARGUMENTS` 用于配置 IPython Notebook：'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: '`IPYTHON_ARGUMENTS` 用于设置 IPython：'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 使用 IPython Notebook 时同样会自动加载 Django settings 模块和数据库 Model。 其实现依赖于定制的 IPython
    插件，Django Extensions 默认会向 IPython Notebook 发送命令 `--ext django_extensions.management.notebook_extension`
    开启该功能， 你可以在 Django 设置中修改 `IPYTHON_ARGUMENTS` 参数覆盖该设置：
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 开启自动加载可以通过引用 Django Extensions 默认 Notebook，或者复制它的自动加载代码到你自己的扩展中。
  prefs: []
  type: TYPE_NORMAL
- en: IPython Notebook 扩展目前并不支持 `--dont-load` 选项。
  prefs: []
  type: TYPE_NORMAL

- en: Todoアイテムの追加を実装する
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://jsprimer.net/use-case/todoapp/form-event/](https://jsprimer.net/use-case/todoapp/form-event/)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ここからはJavaScriptでTodoアプリの機能を作成していきます。
  prefs: []
  type: TYPE_NORMAL
- en: このセクションでは、前のセクションでHTMLに目印をつけたTodoリスト（`#js-todo-list`）に対してTodoアイテムを追加する処理を実装します。
  prefs: []
  type: TYPE_NORMAL
- en: '[](#add-todo-item)*Todoアイテムの追加*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*まず、Todoアプリではどのような操作をしたら、Todoアイテムを追加できるかを見ていきます。'
  prefs: []
  type: TYPE_NORMAL
- en: Todoアプリでは、ユーザーが次のような操作をした場合に、Todoアイテムを追加します。
  prefs: []
  type: TYPE_NORMAL
- en: 入力欄にTodoアイテムのタイトルを入力する
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 入力欄でEnterキーを押して送信する
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: TodoリストにTodoアイテムが追加される
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: これをJavaScriptで実現するには次のことが必要です。
  prefs: []
  type: TYPE_NORMAL
- en: Todoアイテムのタイトルを取得するために、input要素（入力欄）から内容を取得する
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enterキーで送信されたことを知るために、form要素の`submit`イベント（送信）を監視する
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 入力内容をタイトルにしたTodoアイテムを作成し、Todoリスト（`#js-todo-list`）にTodoアイテム要素を追加する
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: まずは、form要素から送信されたイベントを受け取り、入力内容をコンソールログに表示してみることからはじめてみましょう。
  prefs: []
  type: TYPE_NORMAL
- en: '[](#input-to-console)*入力内容をコンソールに表示する*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*form要素でEnterキーを押して送信すると`submit`イベントが発生します。 この`submit`イベントはHTML要素の`addEventListener`メソッドを利用することで受け取れます。'
  prefs: []
  type: TYPE_NORMAL
- en: 次のコードでは、指定したform要素から`submit`イベントが発生したときに呼び出されるコールバック関数を登録しています。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: このようなイベントが発生した際に呼ばれるコールバック関数のことを**イベントリスナー**（イベントをリッスンするものという意味）と呼びます。 またイベントリスナーはイベントハンドラーとも呼ばれることがありますが、この書籍ではこの2つの言葉は同じ意味として扱います。
  prefs: []
  type: TYPE_NORMAL
- en: フォームが送信されたときに入力内容をコンソールに表示するには、 `addEventListener`コールバック関数内で入力内容をConsole APIで出力すればよいことになります。
  prefs: []
  type: TYPE_NORMAL
- en: 入力内容はinput要素の`value`プロパティから取得できます。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: これらを組み合わせて`App.js`に「入力内容をコンソールに表示」する機能を実装してみましょう。 `App`クラスに`mount`というメソッドを定義して、その中に処理を書いていきましょう。
  prefs: []
  type: TYPE_NORMAL
- en: 次のコードでは、フォーム（`#js-form`）をEnterで送信すると、input要素（`#js-form-input`）の内容をコンソールへ表示する処理を実装しています。
  prefs: []
  type: TYPE_NORMAL
- en: src/App.js
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: このままでは、Appの`mount`メソッドは呼び出されないため何も行われません。 そのため、`index.js`も変更して、`App`クラスの`mount`メソッドを呼び出すようにします。
  prefs: []
  type: TYPE_NORMAL
- en: index.js
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: これらの変更後にブラウザでページをリロードすると、Appの`mount`メソッドが実行されるようになります。 `submit`イベントがリッスンされているので、入力欄に何か入力してEnterで送信してみるとその内容がコンソールに表示されます。
  prefs: []
  type: TYPE_NORMAL
- en: '![入力内容がコンソールに表示される](../Images/4136a4c8ddc2954ea1cb3c3881e4e949.png)'
  prefs: []
  type: TYPE_IMG
- en: 先ほどのAppの`mount`メソッドでは、`submit`イベントのイベントリスナー内で`event.preventDefault`メソッドを呼び出しています。
    `event.preventDefault`メソッドは、`submit`イベントの発生元であるフォームが持つデフォルトの動作をキャンセルするメソッドです。
  prefs: []
  type: TYPE_NORMAL
- en: フォームが持つデフォルトの動作とは、フォームの内容を指定したURLへ送信するという動作です。 ここでは`form`要素に送信先が指定されていないため、現在のURLに対してフォームの内容を送信します。
    しかしこの動作は邪魔になるため、`event.preventDefault`メソッドを呼び出すことで、このデフォルトの動作をキャンセルしています。
  prefs: []
  type: TYPE_NORMAL
- en: src/App.jsより抜粋
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 現在のURLに対してフォームの送信が行われると、結果的にページがリロードされてしまいます。 そのため、`event.preventDefault()`を呼び出し、デフォルトの動作をキャンセルしていました。
    `event.preventDefault()`をコメントアウトすると、ページがリロードされてしまうことが確認できます。
  prefs: []
  type: TYPE_NORMAL
- en: src/App.jsから一部をコメントアウトした例
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: ここまでで`todoapp`ディレクトリに、次のような変更を加えました。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: ここまでのTodoアプリは次のURLで確認できます。
  prefs: []
  type: TYPE_NORMAL
- en: '[https://jsprimer.net/use-case/todoapp/form-event/prevent-event/](https://jsprimer.net/use-case/todoapp/form-event/prevent-event/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[](#input-to-todolist)*入力内容をTodoリストに表示する*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*フォーム送信時に入力内容を取得する方法がわかったので、次はその入力内容をTodoリスト（`#js-todo-list`）に表示します。'
  prefs: []
  type: TYPE_NORMAL
- en: HTMLではリストのアイテムを記述する際には`<li>`タグを使います。 また後ほどTodoリストに表示するTodoアイテムの要素には、完了状態を表すチェックボックスや削除ボタンなども含めたいです。
    これらの要素を含むものを手続き的にDOM APIで作成すると見通しが悪くなるため、HTML文字列からHTML要素を生成するユーティリティモジュールを作成しましょう。
  prefs: []
  type: TYPE_NORMAL
- en: 次の`html-util.js`というファイルを`src/view/html-util.js`というパスに作成します。
  prefs: []
  type: TYPE_NORMAL
- en: 'この`html-util.js`は「[ajaxapp: HTML文字列をDOMに追加する](../../ajaxapp/display/#html-to-dom)」でも利用した`escapeSpecialChars`をベースにしています。
    ajaxappでの`escapeHTML`タグ関数では出力は**HTML文字列**でしたが、今回作成する`element`タグ関数の出力は**HTML要素**（Element）です。'
  prefs: []
  type: TYPE_NORMAL
- en: Todoリスト（`#js-todo-list`）というすでに存在する要素に対して要素を**追加**するには、HTML文字列ではなくHTML要素が必要になります。
    また、HTML文字列に対しては`addEventListener`でイベントをリッスンできません。 そのため、チェックボックスの状態が変わったことや削除ボタンが押されたことを知る必要があるTodoアプリではHTML要素が必要になります。
  prefs: []
  type: TYPE_NORMAL
- en: src/view/html-util.js
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '`element`タグ関数では、同じファイルに定義した`htmlToElement`関数を使ってHTML文字列からHTML要素を作成しています。 `htmlToElement`関数の中で利用している[template要素](https://developer.mozilla.org/ja/docs/Web/HTML/Element/template)はHTML5で追加された、HTML文字列の断片からHTML要素を作成できる要素です。'
  prefs: []
  type: TYPE_NORMAL
- en: この`element`タグ関数を使うことで、次のようにHTML文字列からHTML要素を作成できます。 作成した要素は、`appendChild`メソッドなどで既存の要素に子要素として追加できます。
  prefs: []
  type: TYPE_NORMAL
- en: elementタグ関数のサンプルコード
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: ブラウザが提供する`appendChild`メソッドは子要素を追加するだけなので、すでに別の要素がある場合は末尾に追加されます。
  prefs: []
  type: TYPE_NORMAL
- en: '`render`関数は指定したコンテナ要素（親となる要素）の子要素を上書きする関数となります。 動作的には一度子要素をすべて消したあとに`appendChild`で子要素として追加しています。'
  prefs: []
  type: TYPE_NORMAL
- en: render関数のサンプルコード
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 実際に、この`element`タグ関数と`render`関数を使って、フォームから送信された入力内容をTodoリストに要素として追加してみます。
  prefs: []
  type: TYPE_NORMAL
- en: まず最初に、`App.js`から先ほど作成した`html-util.js`の`element`タグ関数と`render`関数を`import`します。
    次に、Todoアイテムをまとめるリストを`todoListElement`として定義し、表示されているTodoアイテムの数を`todoItemCount`として定義します。
  prefs: []
  type: TYPE_NORMAL
- en: '`submit`イベントのリスナー関数で、入力された内容をもとにTodoリストとTodoアイテム数の表示を更新していきます。 Todoアイテムを表現する要素を作成し、Todoリストの子要素として追加（`appendChild`）して、`render`関数を使ってコンテナ要素の中身にTodoリストで上書きしています。
    最後にTodoアイテムの数を1増やして、Todoアイテム数（`#js-todo-count`）のテキスト（`textContent`）を更新します。'
  prefs: []
  type: TYPE_NORMAL
- en: src/App.js
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: これらの変更後にブラウザでページをリロードし、フォームに入力してからEnterを押すとTodoリストに**Todoアイテムが追加**されます。 また、入力内容を送信するたびに`todoItemCount`が加算され、**Todoアイテム数**の表示も更新されます。
  prefs: []
  type: TYPE_NORMAL
- en: '![Todoリストへアイテムを追加](../Images/58a9588c28aa0887c5a618769da1c5fa.png)'
  prefs: []
  type: TYPE_IMG
- en: このセクションでの変更点は次のとおりです。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: ここまでのTodoアプリは次のURLで確認できます。
  prefs: []
  type: TYPE_NORMAL
- en: '[https://jsprimer.net/use-case/todoapp/form-event/add-todo-item/](https://jsprimer.net/use-case/todoapp/form-event/add-todo-item/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[](#conclusion)*まとめ*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*このセクションではform要素の`submit`イベントをリッスンし、入力内容を元にTodoアイテムを作成し、これをTodoリストに追加する機能を実装しました。
    今回のTodoアイテムの追加のように、多くのウェブアプリは何らかのイベントをリッスンして表示を更新します。 このような、イベントが発生したことを元に処理を進める方法を**イベント駆動**（イベントドリブン）と呼びます。'
  prefs: []
  type: TYPE_NORMAL
- en: 今回のTodoアイテムの追加では、`submit`イベントを入力にして、Todoリスト要素を**直接HTML要素として追加**するという方法を取っていました。
    このように直接DOMを更新するという方法はコードが短くなりますが、DOMのみにしか状態が残らないため柔軟性がなくなるという問題があります。 次のセクションでは、実際に起きる問題やそれを解決するための仕組みを見ていきます。
  prefs: []
  type: TYPE_NORMAL
- en: '[](#section-checklist)*このセクションのチェックリスト*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**   フォームの送信を`submit`イベントで受け取り、入力内容を確認した'
  prefs: []
  type: TYPE_NORMAL
- en: HTML文字列からHTML要素を作成する`html-util.js`を実装した
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: フォームからTodoアイテムを追加した
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Todoアイテムの追加に合わせてTodoアイテム数を更新した
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: このセクションで、TodoアプリにTodoアイテムを追加する機能が実装できました。
  prefs: []
  type: TYPE_NORMAL
- en: Todoアイテムを追加できる
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Todoアプリに実装する残りの機能は次のとおりです。
  prefs: []
  type: TYPE_NORMAL
- en: Todoアイテムの完了状態を更新できる
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Todoアイテムを削除できる*****
  prefs:
  - PREF_UL
  type: TYPE_NORMAL

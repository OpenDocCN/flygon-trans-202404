- en: what's the RPC?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: what's the RPC?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: RPC（Remote Procedure CallProtocol）——远程过程调用协议，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 简单来说rpc就是client在不知道任何底层实现的情况下，可以直接调用server的函数方法；而server也可以直接调用client的函数。
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 百度给出的流程图：
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '![](18d8bc3eb13533fadd93e964a9d3fd1f41345b56.jpg)'
  prefs:
  - PREF_H2
  type: TYPE_IMG
- en: 简单了解了什么是rpc，下面我就来在我们的server和client来实现rpc的功能。
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: RPC on my server
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: RPC on my server
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 下面是之前我们给出的tcpserver中的一个函数，用来处理连接
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: build_class之前我们说过，这是我们用来处理数据的protocol，那么rpc的逻辑流程应该都写在这里。现在假设client来调用一个函数sum(x,
    y)， 那么在我们server中就要有这样一个函数。
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 但是客户端来调用，我们如何知道server有这样一个函数呢？这就需要我们提前去处理一下，将希望可以被client调用的函数存起来。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 比如我们可以写这样一个函数，作为装饰器，来将被装饰的函数存起来(HANDLERS), 这样在client调用sum的时候，我们就可以知道，server中是否存在sum这个函数。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 这样函数被装饰起来以后，我们就可以找到这个函数了。当我们知道存在sum这个函数的时候，我就可以从HANDLERS中讲sum取出来，`sum = HANDLERS.get('sum')`,
    然后我们讲x，y两个参数传进去，算出结果，再将结果写回conn中，返回给client。至此，客户端调用服务器函数的大致流程就说完了。
  prefs: []
  type: TYPE_NORMAL
- en: RPC on my client
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: RPC on my client
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 服务器调用client函数也是一样的道理，client中也要和服务器一样，将想要被调用的函数收集起来。当然这个时候，服务器还要做一件事情，就是将客户端的tcp连接通过某种条件储存起来，这样才知道我想去调用哪个client的函数。
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: 现在有很多client来连接我们server，以游戏为例，每个玩家都有自己对应的uid，那么我们就可以将conn根据uid储存起来。`client_conn
    = {uid:conn, ..}` 这样，我们想给哪位玩家发送消息或者做一些其他的事情，就很容易了，只要客户端写好函数功能，我们只要将函数名字，以及对应参数，通过client_conn找到对应玩家的tcp连接，然后将上述数据发送过，那么当客户端计算出结果以后，我们通过一个回调函数，就可以将结果return到服务器了。
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: 现有的rpc框架很多，比如[msgpack-python](https://github.com/msgpack-rpc/msgpack-rpc-python),
    这里有很多语言的rpcSimpleServer，感兴趣的同学可以参考一下。
  prefs: []
  type: TYPE_NORMAL

- en: 'Lab 05: Donation 4.0 - Database/Application Support'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Lab 05: Donation 4.0 - Database/Application Support'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Objectives
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Objectives
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this Lab, you will complete a final refactor of our Donation Case Study -
    **Donation.4.0**. We will build on the previous lab and add in some new features
    and Database Support, and an Application Object. On completion of this lab you'll
    be able to
  prefs: []
  type: TYPE_NORMAL
- en: add Database Support to an Android Application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: work with an 'Application' object
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Step 01
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Setup - Starter Code
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As with the previous labs, you can download the solution/starter code for [Donation.4.0.starter](../archives/Donation.4.0.Starter.zip),
    or continue on with your own version.
  prefs: []
  type: TYPE_NORMAL
- en: 'Your current project (after renaming/copying) should looks as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s101.png)'
  prefs: []
  type: TYPE_IMG
- en: 'In this lab, you are required to do the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Add a new Menu Option - 'Reset' - to clear out any donations after the target
    is reached
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add Database Support to Donation to manage the donations made
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Refactor existing Classes to accommodate the new database classes
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The following steps will guide you through these requirements, so we'll start
    with Menu Option.
  prefs: []
  type: TYPE_NORMAL
- en: Step 02
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Adding a new Menu Option
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'First of all, confirm that the current Menu looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s201.png)'
  prefs: []
  type: TYPE_IMG
- en: 'but we want something like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s202.png)'
  prefs: []
  type: TYPE_IMG
- en: The first thing to do is add in a new resource in strings.xml (or use Android
    Studio (Alt + Return) to fix the string resource error if you paste in the menu
    item directly)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: and then the corresponding menu item in donate.xml
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: It's probably worth removing the 'Settings' menu item at this stage too, and
    its related method in the Base class. Next, edit **Base.java** and add in the
    following method stub
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: to ensure our app won't crash when the menu loads (and looks for a method 'reset')
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the app again and confirm you get the following Menu :'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s202.png)'
  prefs: []
  type: TYPE_IMG
- en: We can't implement this menu option fully yet, so for the moment, we'll just
    'reset' the target amount back to zero (0) - Step 03.
  prefs: []
  type: TYPE_NORMAL
- en: Step 03
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Resetting the Target Amount
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This is more of an interim step but is necessary to ensure the menu event handler
    for the 'Reset' option is working correctly.
  prefs: []
  type: TYPE_NORMAL
- en: First, edit **Donate.java** and introduce an implementation of the 'reset' method
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: the
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: annotation is important - can you explain why?
  prefs: []
  type: TYPE_NORMAL
- en: So add in the code necessary to deal with the Reset Menu option being selected,
    and reset the *totalDonated* back to zero (0). You also need to update the Donate
    UI to reflect this reset, so try and have a go at that too.
  prefs: []
  type: TYPE_NORMAL
- en: Run the app again to confirm that the 'Reset' Menu option is now functioning.
  prefs: []
  type: TYPE_NORMAL
- en: Step 04
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Application Object
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before we complete this step, here's the code you need for the previous step.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: In order to keep out application design coherent, we now bring in an 'Application'
    object.
  prefs: []
  type: TYPE_NORMAL
- en: 'Create a new package called ''ie.app.main'' and incorporate this class here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Application objects need to be references in the AndroidManifest.xml - at the
    very top as 'andorid:name'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Make sure the 'Donation App Started' appears in the logs to verify that it has
    actually been engaged correctly, when you launch the app.
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s401.png)'
  prefs: []
  type: TYPE_IMG
- en: Step 05
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Donation Model
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We now need to refactor the Base class (next Step) and move the donation related
    attributes and method (i.e. the variables target, totalDonated and the donations
    list,and the newDonation() method) into our DonationApp class.
  prefs: []
  type: TYPE_NORMAL
- en: 'This is a revised version of DonationApp - which now manages a list of donations.
    It also centralises the ''makeDonation'' event implementing it as a method. Replace
    your donation with this one:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Step 06
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Base Class Refactoring
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Base activity can now be completely refactored to make use of the DonationApp
    object. You **WILL** have errors at the end of this step, due to referencing our
    (as yet missing) database classes - but we'll fix those in the next few steps.
  prefs: []
  type: TYPE_NORMAL
- en: This is our new Base class
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Step 07
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Adding Database Support
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once you import the necessary Database classes, (to fix the errors from the
    previous step) this step is relatively straight forward - all you have to do is
    replace the method calls that manages the ***donationList*** with the respective
    ***dbManager*** calls.
  prefs: []
  type: TYPE_NORMAL
- en: First thing to do is download the necessary database classes in the [database](database.zip)
    archive and add them to a new *ie.app.database* package in your project.
  prefs: []
  type: TYPE_NORMAL
- en: Take a few moments to investigate the classes and familarise yourself with the
    methods you'll be using.
  prefs: []
  type: TYPE_NORMAL
- en: There are a few classes you'll need to modify to add database support to your
    project, but initially, you need to create an instance of ***DBManager*** in **Base.java**
    and both open/close the database when necessary, so refer to the Lecture Material
    to complete this.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, update your **DonationApp** class with the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '**Note the references to a new *dbManager* object.**'
  prefs: []
  type: TYPE_NORMAL
- en: Also, our Donation class needs a slight refactor, so replace the current class
    with this one.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Once you make these changes, commenting out the donationList List, (and save
    the file) you'll get a number of errors, which actually indicates which classes
    you need to now update and add the database calls (and remove the donationList
    calls).
  prefs: []
  type: TYPE_NORMAL
- en: Each error requires only one line of code to be fixed, so have a go and updating
    each of the classes (and we'll have a look at the solution near the end of the
    Practical Lab).
  prefs: []
  type: TYPE_NORMAL
- en: Once you fix all the errors, and run the app again, you should still be able
    to make donations - but this time those donations are stored in a database.
  prefs: []
  type: TYPE_NORMAL
- en: And as a final check, if you shut down the app and restart it again, you should
    still be able to see the donations Report.
  prefs: []
  type: TYPE_NORMAL
- en: Step 08
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Resetting the Donations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The last step in this lab involves deleting all the donations in the database
    when the user wishes to 'Reset'.
  prefs: []
  type: TYPE_NORMAL
- en: 'There''s actually not a lot required in this step - all you need to do is call
    **reset()** on your datbase object when the user selects the Menu option, so modify
    your reset method (in your Donate.java) as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: You also need to update your *onPrepareOptionsMenu()* method in your **Base**
    class to handle the 'Reset' menu option being disabled/displayed properly, so
    refer to the lecture material for this.
  prefs: []
  type: TYPE_NORMAL
- en: That's about it - with one exception. There's a small bug in the app related
    to when the app restarts and the target **HAS NOT** been reached.
  prefs: []
  type: TYPE_NORMAL
- en: Can you find it, and more importantly, fix it?
  prefs: []
  type: TYPE_NORMAL
- en: Step 09
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Android Device Monitor
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As an exercise of sorts, you should become familar with the Android Device Monitor,
    particularly how it relates to viewing your database on the emulator/device.
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s901.png)'
  prefs:
  - PREF_H2
  type: TYPE_IMG
- en: 'In Android Studio, you launch the Android Device Monitor as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Tools->Android->Android Device Monitor (as below)
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s902.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, you need to navigate to the data/data folder within the application package
    on the device (in our case ie.app) like so:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s903.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Then, scroll/find your database (donations.db) in the ie.app.databases folder:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s904.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Select the "Pull a file from the Device" on the top right-hand-side of the
    window:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s905.png)'
  prefs: []
  type: TYPE_IMG
- en: and save your database file to a local folder.
  prefs: []
  type: TYPE_NORMAL
- en: Next download and install [sqlitebrowser](http://sqlitebrowser.org) which will
    allow us to view our database graphically.
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s906.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Launch your sqlitebrowser app/program to get this window:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s907.png)'
  prefs: []
  type: TYPE_IMG
- en: and then 'Open Database' selecting the database you pulled from the device.
    If everything goes to plan, you should be able to view your database table(s)
    and their content, as well as the SQL that created the tables.
  prefs: []
  type: TYPE_NORMAL
- en: Below, we can see a donations table with 3 donations
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s908.png)'
  prefs: []
  type: TYPE_IMG
- en: and the corresponding entries in our Android App.
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab5s909.png)'
  prefs: []
  type: TYPE_IMG
- en: Solution
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This is a solution to the lab:'
  prefs: []
  type: TYPE_NORMAL
- en: '[Donation.4.0](Donation.4.0.zip)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL

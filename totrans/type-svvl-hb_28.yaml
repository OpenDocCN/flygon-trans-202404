- en: 🚧モジュール
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://typescriptbook.jp/reference/modules](https://typescriptbook.jp/reference/modules)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 注意
  prefs: []
  type: TYPE_NORMAL
- en: '**Experimental!** このページは執筆途中の草稿です。構成が大きく変わることがありえますので、リンクなどをする場合はリンク切れが起こる可能性がある点をご留意ください。このページの内容は、[import、export、require](/reference/import-export-require)をもとに再構成・加筆しています。'
  prefs: []
  type: TYPE_NORMAL
- en: モジュールの基礎[​](#モジュールの基礎 "モジュールの基礎 への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: モジュールの目的[​](#モジュールの目的 "モジュールの目的 への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: プログラムは大きさがさまざまです。行数で見ると、数行のものから数万行のものまであります。
  prefs: []
  type: TYPE_NORMAL
- en: 小さいプログラムなら、1つのファイルでも十分ですが、大きなプログラムは1つのファイルだけで作るのは大変です。
  prefs: []
  type: TYPE_NORMAL
- en: 想像してみてください。何千行もあるプログラムが1つのファイルに詰め込まれている状態は、読みにくく、修正もしにくくなります。
  prefs: []
  type: TYPE_NORMAL
- en: '**保守性の問題** ─ 保守性が低いことです。大量のコードが1つのファイルに詰め込まれているため、変更がしにくいです。コードの見通しが悪いため、1行の変更が他の数千行にどのような影響を与えるのか、予想もつかないことがあります。これは、変更に対して臆病になってしまう原因にもなります。'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**変数名の衝突** ─ コードが長いと、変数名が衝突する危険性が高まります。これにより、関係のない変数を上書きしてしまう恐れがあります。これを避けるために変数名を長くすることもありますが、それは可読性を損ねる原因になります。'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**再利用の問題** ─ たとえば、数千行のコードの中から特定の部分だけを別のプロジェクトで使用したい場合、それらが1つの大きな塊にまとめられているため、必要な部分だけを抜き出せません。無理に読み込むと、不要なコードも一緒に読み込んでしまい、それがどう悪さをするかは予想がつきません。'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: このような問題を解決するのが、**モジュール**(module)と呼ばれる仕組みです。モジュールは1つのファイルを複数のファイルに分割し、関連付けて、ひとつのプログラムとして動かすことができます。
  prefs: []
  type: TYPE_NORMAL
- en: 大規模なプログラムを作る場合、それぞれの機能ごとにモジュールを分けることで、各モジュールを読みやすく、保守性も高く、再利用もしやすくなります。
  prefs: []
  type: TYPE_NORMAL
- en: JavaScriptのモジュール[​](#javascriptのモジュール "JavaScriptのモジュール への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: JavaScriptのモジュールは、`export`または`import`を1つ以上含むJavaScriptファイルを言います。
  prefs: []
  type: TYPE_NORMAL
- en: '`export`は他のモジュールに変数を公開するためのキーワードです。'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`import`は他のモジュールから変数をインポートするキーワードです。'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`export`と`import`を使うと、モジュール間で変数を受け渡しできるようになります。'
  prefs: []
  type: TYPE_NORMAL
- en: たとえば、次は変数`world`をエクスポートしているモジュールです。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 別のファイルでこれをインポートして使います。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 値の公開と非公開[​](#値の公開と非公開 "値の公開と非公開 への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: JavaScriptのモジュールは、明示的に`export`をつけた値だけが公開され、他のモジュールから参照できます。たとえば、次の例の`publicValue`は他のモジュールから利用できます。一方、`privateValue`は外部からは利用できません。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: JavaScriptのモジュールでは、デフォルトで変数や関数などは非公開になるわけです。Javaなどの他の言語では、モジュール(パッケージ)のメンバーがデフォルトで公開になり、非公開にしたいものには`private`修飾子をつける言語があります。そういった言語と比べると、JavaScriptは基本方針が真逆なので注意が必要です。
  prefs: []
  type: TYPE_NORMAL
- en: パッケージとモジュールの違い[​](#パッケージとモジュールの違い "パッケージとモジュールの違い への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: モジュールと似た用語に、パッケージ(package)という言葉があります。プログラミング言語によって、モジュールとパッケージの定義は異なります。JavaScriptでは、これらはどのように捉えられているでしょうか。
  prefs: []
  type: TYPE_NORMAL
- en: モジュールは、基本的にひとつひとつのJavaScript/TypeScriptファイルを指します。詳細は「[スクリプトとモジュール](https://typescriptbook.jp/reference/import-export-require#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A8%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB)」のセクションで説明しますが、JavaScript/TypeScriptファイルのうち、`export`または`import`を1つ以上含んだものがモジュールに当たります。
  prefs: []
  type: TYPE_NORMAL
- en: パッケージは、package.jsonとJavaScriptファイル群を持つディレクトリを指します。package.jsonは、パッケージの名前、バージョン、ライセンスなどのメタデータを記載したファイルです。
  prefs: []
  type: TYPE_NORMAL
- en: モジュールとパッケージには、利用用途の違いがあります。一般的なアプリケーション開発では、複数のJavaScript/TypeScriptファイルに分けて開発します。この際に作られるファイルひとつひとつがモジュールになります。アプリケーションの保守性の担保、コードの再利用性の確保、変数名衝突の回避のために用いられるのがモジュールです。
  prefs: []
  type: TYPE_NORMAL
- en: 一方、パッケージの典型的な目的は配布です。ライブラリ製作者が、プログラムを他者に配布する際に用いられるのがパッケージです。そして、アプリケーション開発者は、自己のアプリケーションにパッケージを組み込む形で、パッケージは利用されていきます。
  prefs: []
  type: TYPE_NORMAL
- en: モジュールとエコシステム[​](#モジュールとエコシステム "モジュールとエコシステム への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: バンドラー[​](#バンドラー "バンドラー への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: JavaScriptでは、複数のJavaScriptファイルを1つのファイルに繋ぎ合わせることをバンドル(bundle)と言います。バンドルを、自動的に行なう開発ツールを、バンドラー(bundler)と呼びます。バンドラーは「モジュールバンドラー」と呼ばれることもあります。
  prefs: []
  type: TYPE_NORMAL
- en: JavaScriptには、さまざまなバンドラーがあります。たとえば、有名なものとしては次のようなバンドラーがあります。
  prefs: []
  type: TYPE_NORMAL
- en: webpack
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: rollup
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: parcel
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: esbuild
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vite
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: これらのバンドラーは、JavaScriptだけではなく、TypeScriptやCSS、画像などさまざまな種類のファイルをバンドルできます。
  prefs: []
  type: TYPE_NORMAL
- en: バンドラーが必要な理由[​](#バンドラーが必要な理由 "バンドラーが必要な理由 への直接リンク")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: JavaScriptのバンドラーを使わないと、Webアプリケーションを実行するために、複数のJavaScriptファイルを個別に読み込む必要があります。これは、いくつかの問題を生みます。
  prefs: []
  type: TYPE_NORMAL
- en: 第一に、ウェブブラウザーがJavaScriptのコードを読み込む際に、多くの時間がかかるようになります。
  prefs: []
  type: TYPE_NORMAL
- en: 第二に、JavaScriptファイル同士の依存関係が整理されないことに起因して、コードが壊れ、バグが起こることがあります。
  prefs: []
  type: TYPE_NORMAL
- en: 第三に、JavaScriptコードが最適化された書き方になっていない場合、アプリケーションの実行パフォーマンスが悪くなることがあります。
  prefs: []
  type: TYPE_NORMAL
- en: このような問題を解決するがバンドラーの役割です。
  prefs: []
  type: TYPE_NORMAL
- en: サーバーサイドJSではバンドラーの利点は少ない[​](#サーバーサイドjsではバンドラーの利点は少ない "サーバーサイドJSではバンドラーの利点は少ない
    への直接リンク")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: JavaScriptはウェブブラウザーで実行するために作られた言語ですが、サーバーサイドでも使えます。サーバーサイドのJavaScript実行環境のひとつにNode.jsがあります。Node.jsは、古くからモジュールシステムを内部で実装しているため、JavaScriptにESモジュールのようなモジュールシステムがまだ無い時代から、モジュールが使えていました。そのため、サーバーサイドJavaScriptの環境では、バンドラーの必要性が生まれませんでした。
  prefs: []
  type: TYPE_NORMAL
- en: 昨今のJavaScriptはモジュールシステムを持っているため、バンドラーを使わなくともモジュールを実現できます。これはフロントエンドでも同様です。しかしながら、フロントエンドでは数百、数千のモジュールをバラバラにダウンロードして実行するのは時間がかかるため、ひとつのJavaScriptファイルにまとめるバンドラーの役割というのは、依然として重要です。
  prefs: []
  type: TYPE_NORMAL
- en: 一方で、サーバーサイドでは、モジュールが数百、数千とあったとしても、モジュールをロードするのはサーバー起動時だけです。そのため、バンドラーの利点はほぼありません。
  prefs: []
  type: TYPE_NORMAL
- en: モジュールシステム[​](#モジュールシステム "モジュールシステム への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: CommonJSとESモジュール[​](#commonjsとesモジュール "CommonJSとESモジュール への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: CommonJSとESモジュールが混在している理由[​](#commonjsとesモジュールが混在している理由 "CommonJSとESモジュールが混在している理由
    への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: これをお読みの皆さんの中には、JavaScriptやTypeScript以外のプログラミング言語を経験したことがある人もいるかと思います。他の言語で、複数のモジュールシステムが共存している言語を使ったことはありますでしょうか。
  prefs: []
  type: TYPE_NORMAL
- en: JavaScriptには、系統が異なるモジュールシステムが、少なくとも2つ存在しています。ESモジュールとCommonJSです。こうした状況は、プログラミング言語としては、珍しいことです。JavaScriptのモジュールまわりを理解するのを難しくしている要因でもあります。
  prefs: []
  type: TYPE_NORMAL
- en: では、どうしてJavaScriptは2系統もモジュールシステムを持つようになったのでしょうか？ ここでは、JavaScriptの現状に至る流れを歴史からひも解いていきます。
  prefs: []
  type: TYPE_NORMAL
- en: ひとつめのモジュールシステム[​](#ひとつめのモジュールシステム "ひとつめのモジュールシステム への直接リンク")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: JavaScriptのモジュールシステムは、ブラウザよりも先んじて、サーバーサイドJavaScript、とりわけNode.jsの文脈で発展してきた経緯があります。
  prefs: []
  type: TYPE_NORMAL
- en: JavaScriptで広く普及しているモジュールシステムのひとつがCommonJSです。CommonJSの歴史をさかのぼると、2009年のServerJS発足に至ります。ServerJSはJavaScriptをサーバーサイドで使えるようにすることを目指し、サーバーサイドJavaScriptの共通APIを策定する標準化プロジェクトでした。のちに、CommonJSに改名されます。
  prefs: []
  type: TYPE_NORMAL
- en: サーバーサイドにJavaScriptを持ってくると一言で言っても、ブラウザのJavaScriptをそのまま持ち込んでもうまくいきません。たとえば、ブラウザには`<script>`タグがあるので、ひとつのページに複数の`<script>`タグを書くことで、複数のJavaScriptが実行できます。一方、サーバーサイドにはページという概念がありません。
  prefs: []
  type: TYPE_NORMAL
- en: また、当時のJavaScriptにはESモジュールのようなモジュールシステムもありませんでした。そのため、JavaScriptファイルを複数ロードできる仕組みを考えるところから始めなければなりませんでした。
  prefs: []
  type: TYPE_NORMAL
- en: そこで考え出された仕様がCommonJSのモジュールです。おなじみの`require()`や`module.exports`です。CommonJSは、モジュールシステムが存在しない当時のJavaScriptの文法や機能の枠を超えずに、関数や変数で工夫することで、モジュール的なものを成立させるものでした。
  prefs: []
  type: TYPE_NORMAL
- en: Node.jsはCommonJSと同時期にリリースされましたが、Node.jsに採用されたモジュールシステムがこのCommonJSでした。このおかげで、Node.jsにおいてはサーバーサイドJavaScriptでもファイルの分割と、複数ファイルのロードができるようになっていました。このモジュールシステムは、Node.jsユーザーに受け入れられはじめ、ライブラリを公開できるnpmなど、モジュールまわりのエコシステムも発展していきました。
  prefs: []
  type: TYPE_NORMAL
- en: ちなみに、CommonJSやNode.jsがスタートした2009年の前年には、ECMAScript 4草案破棄というショッキングな出来ごとがありました。ES4には、モジュールシステムをJavaScriptに追加する仕様も盛り込まれていました。もし、ES4が実現していたら、CommonJSは必要無かったかも知れません。現実はESの仕様を決めるブラウザベンダー間での意見と対立があり、JavaScriptを改善する動きは仲たがいで終わってしまいました。
  prefs: []
  type: TYPE_NORMAL
- en: Node.jsの登場時期がそんなバッドタイミングだったこともあり、JavaScript自体がモジュールシステムを改善するのはなかなか期待できない状況でした。そのため、Node.jsは既存のJavaScriptでできる範囲内の解決策として、モジュールシステムにCommonJSを採用したという見方もできます。
  prefs: []
  type: TYPE_NORMAL
- en: CommonJSはサーバーサイドで生まれ、発展してきました。CommonJSの土台に乗ったライブラリも数多く作られました。こうしたライブラリは、クライアントサイドでも需要がありました。そのため、webpackを筆頭にモジュールバンドラーはCommonJSをサポートしてきました。CommonJSの生い立ちはサーバーサイドではあったものの、モジュールバンドラーの対応によって、フロントエンドもCommonJSに頼る状況が醸成されました。
  prefs: []
  type: TYPE_NORMAL
- en: ふたつめのモジュールシステム[​](#ふたつめのモジュールシステム "ふたつめのモジュールシステム への直接リンク")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: CommonJSの誕生から歴史は流れ、2015年になると、ES6という新しいJavaScriptの標準仕様が確定します。これはJavaScriptの10年数ぶりの大型アップデートです。そこには、ES6
    Modulesというモジュールシステムを実現するための仕様も盛り込まれていました。皆さんご存知の`import`文と`export`文です。これは、JavaScript初のJavaScriptネイティブのモジュールシステムです。CommonJSが草の根活動で規格化されたモジュールシステムだとすると、ESモジュールは本家が発表した公式的・標準的なモジュールシステムだとも言えます。
  prefs: []
  type: TYPE_NORMAL
- en: JavaScript界は、サーバーサイドもクライアントサイドも関係なく、ES6に対応する中で、ES6 Modulesも導入する方向になり、2016年頃からESモジュール導入に向けて議論が始まりました。議論の中心は、やはり、在来のモジュールシステムであるCommonJSと新システムのESモジュールの共存についてです。
  prefs: []
  type: TYPE_NORMAL
- en: ESモジュールの仕様が確定する頃には、JavaScriptはCommonJS前提とした環境ができあがっていて、CommonJSに準拠したNPMパッケージも沢山あったため、CommonJSを切り捨てる選択肢はありませんでした。もしも、CommonJSを切り捨ててしまうと、過去の資産をほぼすべて失うことになるわけで、CommonJSとESモジュールの共存はNode.jsにとって重要なテーマだったのです。
  prefs: []
  type: TYPE_NORMAL
- en: たとえば、サーバーサイドJavaScriptのNode.jsひとつとっても、長い議論のすえ、2017年にNode.js v8.5.0にて、ESモジュールが実験的な機能としてリリースされます。その後、2019年にv13.2.0にて、ESモジュールから「実験的な機能」というラベルが外れ、プロダクションで使われることを想定した機能に昇格しました。そして2020年には、CommonJSの名前付きエクスポートがESモジュールの名前付きインポートでロードできるようになり、次第にNode.jsでESモジュールを動かす環境が整ってきています。
  prefs: []
  type: TYPE_NORMAL
- en: ESモジュール環境が整備されてきたとは言っても、CommonJSは10年以上、JavaScriptを支えてきており、もはや切っても切れない関係になっています。そのため、今日現在においては、2つのモジュールシステムがJavaScriptに生きているわけです。
  prefs: []
  type: TYPE_NORMAL
- en: まとめ[​](#まとめ "まとめ への直接リンク")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: JavaScriptにはCommonJSとESモジュールの2つのモジュールシステムがある。
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CommonJSはJSと10年以上に及ぶ長く深いつながりがある。
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: JS界はCommonJSとESモジュールが共存する道を選んだ。
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CommonJSとESモジュールの違い[​](#commonjsとesモジュールの違い "CommonJSとESモジュールの違い への直接リンク")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '`import`と`require`の違い[​](#importとrequireの違い "importとrequireの違い への直接リンク")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: JavaScriptでは、モジュールから変数などの値をインポートする際に、`import`と`require`を用います。この2つはよく似ていますが、それぞれ異なるモジュールシステムの書き方です。
  prefs: []
  type: TYPE_NORMAL
- en: JavaScriptのモジュールシステムはいくつかありますが、代表的なものが次の2つです。
  prefs: []
  type: TYPE_NORMAL
- en: ESモジュール
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CommonJS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: この2つのモジュールシステムの違いの詳細は、**(TODO参照先記事記載)** で解説していますので、そちらをご覧ください。
  prefs: []
  type: TYPE_NORMAL
- en: import[​](#import "import への直接リンク")
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: '`import`は、JavaScriptのモジュールシステムのひとつであるESモジュールで用いる構文です。`import`は他のモジュールでエクスポートされた変数や関数をインポートするのに用いられます。たとえば、次のような使い方ができます。'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: require[​](#require "require への直接リンク")
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: 一方で、`require`は、CommonJSというモジュールシステムで用いる関数です。`require`関数は、他のモジュールから変数や関数をインポートするのに使われます。たとえば、次のような使い方になります。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '`export`と`module.exports`の違い[​](#exportとmoduleexportsの違い "exportとmoduleexportsの違い
    への直接リンク")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '`import`と`require`は、他のモジュールから値をインポートするためのものでした。これと対をなすものとして、`export`と`module.export`があります。これらは、他のモジュールに値をエクスポートするためのものです。`export`と`module.export`も、それぞれ異なるモジュールシステムで使われます。'
  prefs: []
  type: TYPE_NORMAL
- en: export[​](#export "export への直接リンク")
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: JavaScriptの`export`は、ESモジュールというモジュールシステムで用いる構文です。`export`を使うと、モジュール内で定義した変数や関数などを、エクスポートすることができます。たとえば、次のような使い方ができます。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: module.exports[​](#moduleexports "module.exports への直接リンク")
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: 一方で、`module.exports`は、CommonJSというモジュールシステムで用いる変数です。CommonJSでは、モジュール内で定義された変数や関数を、`module.exports`に代入することで、エクスポートできます。たとえば、次のような書き方になります。
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: ESモジュールの構文[​](#esモジュールの構文 "ESモジュールの構文 への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: モジュール解決[​](#モジュール解決 "モジュール解決 への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: ESモジュールの仕様[​](#esモジュールの仕様 "ESモジュールの仕様 への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: CommonJSのAPI[​](#commonjsのapi "CommonJSのAPI への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: TypeScriptとモジュール[​](#typescriptとモジュール "TypeScriptとモジュール への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: ESモジュールのベストプラクティス[​](#esモジュールのベストプラクティス "ESモジュールのベストプラクティス への直接リンク")
  prefs:
  - PREF_H2
  type: TYPE_NORMAL

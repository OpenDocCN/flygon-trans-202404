- en: 'Lab 04: Donation 3.0 - Donation Object Model'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Lab 04: Donation 3.0 - Donation Object Model'
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Objectives
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Objectives
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Evolve the Donation android app to include a Donation Object Model and Base
    class
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use a CustomAdapter in the Report View.
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Refactor our menus with xml driven event handling
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Step 01
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Donation Model & Base Class
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In order to keep our application design coherent, we now bring in an Base class
    and a Donation class to manage our Donations. You can continue with your own version
    of the app or start with the solution from the previous lab - [Donation.2.0](../archives/Donation.2.0.zip)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: But before we do anything, it's probably a good idea to rename/copy or project
    to **Donation.3.0** like we did in the previous lab - so go ahead and do that
    now (just make sure it's not open Android Studio!)
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, first, create a new package called ''ie.app.models'' in ''main'' and bring
    in this class here:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, Create a new class called ''Base'' and add it to the ''ie.app.activities''
    package: (and fix the errors obviously :-) )'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Notice our List of Donations in the Base class - we will use this list to display
    our Donations in the Report.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: There is still one error remaining, can you work out why, and more importantly,
    how to fix it?
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: Hint - it relates to class inheritance, and some refactoring that needs to be
    done.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: 'Your project should now look as follows:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab4s101.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
- en: Also, pay particular attention to the 'settings', 'report' and 'donate' methods
    - these will be triggered directly by our menu options via xml, which we'll look
    at in Step 05.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: Step 02
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Refactored Donate
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Donate activity can now be completely refactored to make use of the Base
    class.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Replace your version with this and execute it - fix any missing import statements
    necessary.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: Look carefully at the changes to this version over the previous attempt.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: Step 03
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Refactored Report - New 'Layout'
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We now rework Report to render the actual donations - held in the Base class
    list.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: First some layout additions. Include these new string resources in strings.xml
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This is a new layout - to be called 'row_donate.xml'. Place this in the 'layout'
    folder.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Step 04
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Refactored Report - New 'Class'
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Finally, rework the Report class to remove the hard coded values - and use a
    different 'adapter'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This is the new adapter - DonationAdapter. You can place this at the end of
    the Report class (outside the closing brace) if you like:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: If all goes well - then you should be able to make donations, and then see a
    list of them in the report activity.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '![](lab4s401.png) ![](lab4s402.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
- en: Step 05
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Refactored Menu - New 'Event Handling'
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you recall from Step 01, our Base class has 3 particular methods that we
    haven't made use of - yet
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: We will now use these methods, and using the **onClick** attribute in our MenuItems,
    we will 'bind' these methods to our menu options.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: 'Firstly, edit your menu_donate.xml and ensure it now looks as follows:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '**note the added onClick attributes for each MenuItem, it directly corresponds
    to the method names in our Base class**'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**请注意为每个 MenuItem 添加的 onClick 属性，它直接对应于我们基类中的方法名称**'
- en: We can now refactor our Donate & Report classes and **Remove** the menu inflation
    and event handling code in both classes.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以重构我们的 Donate 和 Report 类，并**移除**两个类中的菜单膨胀和事件处理代码。
- en: 'So, both classes should look as follows:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，两个类应如下所示：
- en: '**Donate**'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '**捐赠**'
- en: '[PRE9]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '**Report**'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '**报告**'
- en: '[PRE10]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Run your app once more, to confirm the changes and that your menu still works
    as it should.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 再次运行您的应用程序，确认更改并确保您的菜单仍然按预期工作。
- en: Solution
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 解决方案
- en: Exercise & Solution
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 练习与解决方案
- en: As a final exercise, try and add some event handling to the Report Activity
    - i.e. when the user selects a row in Report List, display a simple toast detailing
    which row was selected and the donation data from that row.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 作为最后的练习，尝试为 Report Activity 添加一些事件处理 - 即当用户在 Report List 中选择一行时，显示一个简单的提示，详细说明选择了哪一行以及该行的捐赠数据。
- en: 'Something like this:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于这样：
- en: '![](lab4s701.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](lab4s701.png)'
- en: You may find the following useful if you need to refactor your Donation model
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要重构您的捐赠模型，您可能会发现以下内容有用
- en: '![](lab4s702.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![](lab4s702.png)'
- en: and
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 和
- en: '![](lab4s703.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](lab4s703.png)'
- en: 'Project Solution (and Starter for the next lab):'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 项目解决方案（下一个实验的入门）：
- en: '[Donation.4.0.Starter](../archives/Donation.4.0.Starter.zip)'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[捐赠.4.0.入门](../archives/Donation.4.0.Starter.zip)'
